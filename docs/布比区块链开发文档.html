<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <title>布比区块链开发文档.html</title>
  <meta name="generator" content="Haroopad 0.13.1" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>div.oembedall-githubrepos{border:1px solid #DDD;border-radius:4px;list-style-type:none;margin:0 0 10px;padding:8px 10px 0;font:13.34px/1.4 helvetica,arial,freesans,clean,sans-serif;width:452px;background-color:#fff}div.oembedall-githubrepos .oembedall-body{background:-moz-linear-gradient(center top,#FAFAFA,#EFEFEF);background:-webkit-gradient(linear,left top,left bottom,from(#FAFAFA),to(#EFEFEF));border-bottom-left-radius:4px;border-bottom-right-radius:4px;border-top:1px solid #EEE;margin-left:-10px;margin-top:8px;padding:5px 10px;width:100%}div.oembedall-githubrepos h3{font-size:14px;margin:0;padding-left:18px;white-space:nowrap}div.oembedall-githubrepos p.oembedall-description{color:#444;font-size:12px;margin:0 0 3px}div.oembedall-githubrepos p.oembedall-updated-at{color:#888;font-size:11px;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats{border:none;float:right;font-size:11px;font-weight:700;padding-left:15px;position:relative;z-index:5;margin:0}div.oembedall-githubrepos ul.oembedall-repo-stats li{border:none;color:#666;display:inline-block;list-style-type:none;margin:0!important}div.oembedall-githubrepos ul.oembedall-repo-stats li a{background-color:transparent;border:none;color:#666!important;background-position:5px -2px;background-repeat:no-repeat;border-left:1px solid #DDD;display:inline-block;height:21px;line-height:21px;padding:0 5px 0 23px}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a{border-left:medium none;margin-right:-3px}div.oembedall-githubrepos ul.oembedall-repo-stats li a:hover{background:5px -27px no-repeat #4183C4;color:#FFF!important;text-decoration:none}div.oembedall-githubrepos ul.oembedall-repo-stats li:first-child a:hover{border-bottom-left-radius:3px;border-top-left-radius:3px}ul.oembedall-repo-stats li:last-child a:hover{border-bottom-right-radius:3px;border-top-right-radius:3px}span.oembedall-closehide{background-color:#aaa;border-radius:2px;cursor:pointer;margin-right:3px}div.oembedall-container{margin-top:5px;text-align:left}.oembedall-ljuser{font-weight:700}.oembedall-ljuser img{vertical-align:bottom;border:0;padding-right:1px}.oembedall-stoqembed{border-bottom:1px dotted #999;float:left;overflow:hidden;width:730px;line-height:1;background:#FFF;color:#000;font-family:Arial,Liberation Sans,DejaVu Sans,sans-serif;font-size:80%;text-align:left;margin:0;padding:0}.oembedall-stoqembed a{color:#07C;text-decoration:none;margin:0;padding:0}.oembedall-stoqembed a:hover{text-decoration:underline}.oembedall-stoqembed a:visited{color:#4A6B82}.oembedall-stoqembed h3{font-family:Trebuchet MS,Liberation Sans,DejaVu Sans,sans-serif;font-size:130%;font-weight:700;margin:0;padding:0}.oembedall-stoqembed .oembedall-reputation-score{color:#444;font-size:120%;font-weight:700;margin-right:2px}.oembedall-stoqembed .oembedall-user-info{height:35px;width:185px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-gravatar32{float:left;height:32px;width:32px}.oembedall-stoqembed .oembedall-user-info .oembedall-user-details{float:left;margin-left:5px;overflow:hidden;white-space:nowrap;width:145px}.oembedall-stoqembed .oembedall-question-hyperlink{font-weight:700}.oembedall-stoqembed .oembedall-stats{background:#EEE;margin:0 0 0 7px;padding:4px 7px 6px;width:58px}.oembedall-stoqembed .oembedall-statscontainer{float:left;margin-right:8px;width:86px}.oembedall-stoqembed .oembedall-votes{color:#555;padding:0 0 7px;text-align:center}.oembedall-stoqembed .oembedall-vote-count-post{font-size:240%;color:#808185;display:block;font-weight:700}.oembedall-stoqembed .oembedall-views{color:#999;padding-top:4px;text-align:center}.oembedall-stoqembed .oembedall-status{margin-top:-3px;padding:4px 0;text-align:center;background:#75845C;color:#FFF}.oembedall-stoqembed .oembedall-status strong{color:#FFF;display:block;font-size:140%}.oembedall-stoqembed .oembedall-summary{float:left;width:635px}.oembedall-stoqembed .oembedall-excerpt{line-height:1.2;margin:0;padding:0 0 5px}.oembedall-stoqembed .oembedall-tags{float:left;line-height:18px}.oembedall-stoqembed .oembedall-tags a:hover{text-decoration:none}.oembedall-stoqembed .oembedall-post-tag{background-color:#E0EAF1;border-bottom:1px solid #3E6D8E;border-right:1px solid #7F9FB6;color:#3E6D8E;font-size:90%;line-height:2.4;margin:2px 2px 2px 0;padding:3px 4px;text-decoration:none;white-space:nowrap}.oembedall-stoqembed .oembedall-post-tag:hover{background-color:#3E6D8E;border-bottom:1px solid #37607D;border-right:1px solid #37607D;color:#E0EAF1}.oembedall-stoqembed .oembedall-fr{float:right}.oembedall-stoqembed .oembedall-statsarrow{background-image:url(http://cdn.sstatic.net/stackoverflow/img/sprites.png?v=3);background-repeat:no-repeat;overflow:hidden;background-position:0 -435px;float:right;height:13px;margin-top:12px;width:7px}.oembedall-facebook1{border:1px solid #1A3C6C;padding:0;font:13.34px/1.4 verdana;width:500px}.oembedall-facebook2{background-color:#627add}.oembedall-facebook2 a{color:#e8e8e8;text-decoration:none}.oembedall-facebookBody{background-color:#fff;vertical-align:top;padding:5px}.oembedall-facebookBody .contents{display:inline-block;width:100%}.oembedall-facebookBody div img{float:left;margin-right:5px}div.oembedall-lanyard{-webkit-box-shadow:none;-webkit-transition-delay:0s;-webkit-transition-duration:.4000000059604645s;-webkit-transition-property:width;-webkit-transition-timing-function:cubic-bezier(0.42,0,.58,1);background-attachment:scroll;background-clip:border-box;background-color:transparent;background-image:none;background-origin:padding-box;border-width:0;box-shadow:none;color:#112644;display:block;float:left;font-family:'Trebuchet MS',Trebuchet,sans-serif;font-size:16px;height:253px;line-height:19px;margin:0;max-width:none;min-height:0;outline:#112644 0;overflow-x:visible;overflow-y:visible;padding:0;position:relative;text-align:left;vertical-align:baseline;width:804px}div.oembedall-lanyard .tagline{font-size:1.5em}div.oembedall-lanyard .wrapper{overflow:hidden;clear:both}div.oembedall-lanyard .split{float:left;display:inline}div.oembedall-lanyard .prominent-place .flag:active,div.oembedall-lanyard .prominent-place .flag:focus,div.oembedall-lanyard .prominent-place .flag:hover,div.oembedall-lanyard .prominent-place .flag:link,div.oembedall-lanyard .prominent-place .flag:visited{float:left;display:block;width:48px;height:48px;position:relative;top:-5px;margin-right:10px}div.oembedall-lanyard .place-context{font-size:.889em}div.oembedall-lanyard .prominent-place .sub-place{display:block}div.oembedall-lanyard .prominent-place{font-size:1.125em;line-height:1.1em;font-weight:400}div.oembedall-lanyard .main-date{color:#8CB4E0;font-weight:700;line-height:1.1}div.oembedall-lanyard .first{width:48.57%;margin:0 0 0 2.857%}.mermaid .label{color:#333}.node circle,.node polygon,.node rect{fill:#cde498;stroke:#13540c;stroke-width:1px}.edgePath .path{stroke:green;stroke-width:1.5px}.cluster rect{fill:#cdffb2;rx:40;stroke:#6eaa49;stroke-width:1px}.cluster text{fill:#333}.actor{stroke:#13540c;fill:#cde498}text.actor{fill:#000;stroke:none}.actor-line{stroke:grey}.messageLine0{stroke-width:1.5;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#333}.messageLine1{stroke-width:1.5;stroke-dasharray:"2 2";stroke:#333}#arrowhead{fill:#333}#crosshead path{fill:#333!important;stroke:#333!important}.messageText{fill:#333;stroke:none}.labelBox{stroke:#326932;fill:#cde498}.labelText,.loopText{fill:#000;stroke:none}.loopLine{stroke-width:2;stroke-dasharray:"2 2";marker-end:"url(#arrowhead)";stroke:#326932}.note{stroke:#6eaa49;fill:#fff5ad}.noteText{fill:#000;stroke:none;font-family:'trebuchet ms',verdana,arial;font-size:14px}.section{stroke:none;opacity:.2}.section0,.section2{fill:#6eaa49}.section1,.section3{fill:#fff;opacity:.2}.sectionTitle0,.sectionTitle1,.sectionTitle2,.sectionTitle3{fill:#333}.sectionTitle{text-anchor:start;font-size:11px;text-height:14px}.grid .tick{stroke:lightgrey;opacity:.3;shape-rendering:crispEdges}.grid path{stroke-width:0}.today{fill:none;stroke:red;stroke-width:2px}.task{stroke-width:2}.taskText{text-anchor:middle;font-size:11px}.taskTextOutsideRight{fill:#000;text-anchor:start;font-size:11px}.taskTextOutsideLeft{fill:#000;text-anchor:end;font-size:11px}.taskText0,.taskText1,.taskText2,.taskText3{fill:#fff}.task0,.task1,.task2,.task3{fill:#487e3a;stroke:#13540c}.taskTextOutside0,.taskTextOutside1,.taskTextOutside2,.taskTextOutside3{fill:#000}.active0,.active1,.active2,.active3{fill:#cde498;stroke:#13540c}.activeText0,.activeText1,.activeText2,.activeText3{fill:#000!important}.done0,.done1,.done2,.done3{stroke:grey;fill:lightgrey;stroke-width:2}.doneText0,.doneText1,.doneText2,.doneText3{fill:#000!important}.crit0,.crit1,.crit2,.crit3{stroke:#f88;fill:red;stroke-width:2}.activeCrit0,.activeCrit1,.activeCrit2,.activeCrit3{stroke:#f88;fill:#cde498;stroke-width:2}.doneCrit0,.doneCrit1,.doneCrit2,.doneCrit3{stroke:#f88;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges}.activeCritText0,.activeCritText1,.activeCritText2,.activeCritText3,.doneCritText0,.doneCritText1,.doneCritText2,.doneCritText3{fill:#000!important}.titleText{text-anchor:middle;font-size:18px;fill:#000}text{font-family:'trebuchet ms',verdana,arial;font-size:14px}html{height:100%}body{margin:0!important;padding:5px 20px 26px!important;background-color:#fff;font-family:"Lucida Grande","Segoe UI","Apple SD Gothic Neo","Malgun Gothic","Lucida Sans Unicode",Helvetica,Arial,sans-serif;font-size:.9em;overflow-x:hidden;overflow-y:auto}br,h1,h2,h3,h4,h5,h6{clear:both}hr.page{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAECAYAAACtBE5DAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OENDRjNBN0E2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OENDRjNBN0I2NTZBMTFFMEI3QjRBODM4NzJDMjlGNDgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4Q0NGM0E3ODY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4Q0NGM0E3OTY1NkExMUUwQjdCNEE4Mzg3MkMyOUY0OCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PqqezsUAAAAfSURBVHjaYmRABcYwBiM2QSA4y4hNEKYDQxAEAAIMAHNGAzhkPOlYAAAAAElFTkSuQmCC) repeat-x;border:0;height:3px;padding:0}hr.underscore{border-top-style:dashed!important}body >:first-child{margin-top:0!important}img.plugin{box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:3px}iframe{border:0}figure{-webkit-margin-before:0;-webkit-margin-after:0;-webkit-margin-start:0;-webkit-margin-end:0}kbd{border:1px solid #aaa;-moz-border-radius:2px;-webkit-border-radius:2px;border-radius:2px;-moz-box-shadow:1px 2px 2px #ddd;-webkit-box-shadow:1px 2px 2px #ddd;box-shadow:1px 2px 2px #ddd;background-color:#f9f9f9;background-image:-moz-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-o-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:-webkit-linear-gradient(top,#eee,#f9f9f9,#eee);background-image:linear-gradient(top,#eee,#f9f9f9,#eee);padding:1px 3px;font-family:inherit;font-size:.85em}.oembeded .oembed_photo{display:inline-block}img[data-echo]{margin:25px 0;width:100px;height:100px;background:url(../img/ajax.gif) center center no-repeat #fff}.spinner{display:inline-block;width:10px;height:10px;margin-bottom:-.1em;border:2px solid rgba(0,0,0,.5);border-top-color:transparent;border-radius:100%;-webkit-animation:spin 1s infinite linear;animation:spin 1s infinite linear}.spinner:after{content:'';display:block;width:0;height:0;position:absolute;top:-6px;left:0;border:4px solid transparent;border-bottom-color:rgba(0,0,0,.5);-webkit-transform:rotate(45deg);transform:rotate(45deg)}@-webkit-keyframes spin{to{-webkit-transform:rotate(360deg)}}@keyframes spin{to{transform:rotate(360deg)}}p.toc{margin:0!important}p.toc ul{padding-left:10px}p.toc>ul{padding:10px;margin:0 10px;display:inline-block;border:1px solid #ededed;border-radius:5px}p.toc li,p.toc ul{list-style-type:none}p.toc li{width:100%;padding:0;overflow:hidden}p.toc li a::after{content:"."}p.toc li a:before{content:"• "}p.toc h5{text-transform:uppercase}p.toc .title{float:left;padding-right:3px}p.toc .number{margin:0;float:right;padding-left:3px;background:#fff;display:none}input.task-list-item{margin-left:-1.62em}.markdown{font-family:"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Lucida Grande","Lucida Sans Unicode","Lucida Sans",'Segoe UI',AppleSDGothicNeo-Medium,'Malgun Gothic',Verdana,Tahoma,sans-serif;padding:20px}.markdown a{text-decoration:none;vertical-align:baseline}.markdown a:hover{text-decoration:underline}.markdown h1{font-size:2.2em;font-weight:700;margin:1.5em 0 1em}.markdown h2{font-size:1.8em;font-weight:700;margin:1.275em 0 .85em}.markdown h3{font-size:1.6em;font-weight:700;margin:1.125em 0 .75em}.markdown h4{font-size:1.4em;font-weight:700;margin:.99em 0 .66em}.markdown h5{font-size:1.2em;font-weight:700;margin:.855em 0 .57em}.markdown h6{font-size:1em;font-weight:700;margin:.75em 0 .5em}.markdown h1+p,.markdown h1:first-child,.markdown h2+p,.markdown h2:first-child,.markdown h3+p,.markdown h3:first-child,.markdown h4+p,.markdown h4:first-child,.markdown h5+p,.markdown h5:first-child,.markdown h6+p,.markdown h6:first-child{margin-top:0}.markdown hr{border:1px solid #ccc}.markdown p{margin:1em 0;word-wrap:break-word}.markdown ol{list-style-type:decimal}.markdown li{display:list-item;line-height:1.4em}.markdown blockquote{margin:1em 20px}.markdown blockquote>:first-child{margin-top:0}.markdown blockquote>:last-child{margin-bottom:0}.markdown blockquote cite:before{content:'\2014 \00A0'}.markdown .code{border-radius:3px;word-wrap:break-word}.markdown pre{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;overflow:auto;padding:.5em}.markdown pre code{border:0;display:block}.markdown pre>code{font-family:Consolas,Inconsolata,Courier,monospace;font-weight:700;white-space:pre;margin:0}.markdown code{border-radius:3px;word-wrap:break-word;border:1px solid #ccc;padding:0 5px;margin:0 2px}.markdown img{max-width:100%}.markdown mark{color:#000;background-color:#fcf8e3}.markdown table{padding:0;border-collapse:collapse;border-spacing:0;margin-bottom:16px}.markdown table tr td,.markdown table tr th{border:1px solid #ccc;margin:0;padding:6px 13px}.markdown table tr th{font-weight:700}.markdown table tr th>:first-child{margin-top:0}.markdown table tr th>:last-child{margin-bottom:0}.markdown table tr td>:first-child{margin-top:0}.markdown table tr td>:last-child{margin-bottom:0}.github{padding:20px;font-family:"Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei",STHeiti,SimSun,"Segoe UI",AppleSDGothicNeo-Medium,'Malgun Gothic',Arial,freesans,sans-serif;font-size:15px;background:#fff;line-height:1.6;-webkit-font-smoothing:antialiased}.github a{color:#3269a0}.github a:hover{color:#4183c4}.github h2{border-bottom:1px solid #e6e6e6;line-height:1.6}.github h6{color:#777}.github hr{border:1px solid #e6e6e6}.github pre>code{font-size:.9em;font-family:Consolas,Inconsolata,Courier,monospace}.github blockquote>code,.github h1>code,.github h2>code,.github h3>code,.github h4>code,.github h5>code,.github h6>code,.github li>code,.github p>code,.github td>code{background-color:rgba(0,0,0,.07);font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;font-size:85%;padding:.2em .5em;border:0}.github blockquote{border-left:4px solid #e6e6e6;padding:0 15px;font-style:italic}.github table{background-color:#fafafa}.github table tr td,.github table tr th{border:1px solid #e6e6e6}.github table tr:nth-child(2n){background-color:#f2f2f2}.hljs{display:block;overflow-x:auto;padding:.5em;background:#fdf6e3;color:#657b83;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#93a1a1}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#eee8d5}.MathJax_Hover_Frame{border-radius:.25em;-webkit-border-radius:.25em;-moz-border-radius:.25em;-khtml-border-radius:.25em;box-shadow:0 0 15px #83A;-webkit-box-shadow:0 0 15px #83A;-moz-box-shadow:0 0 15px #83A;-khtml-box-shadow:0 0 15px #83A;border:1px solid #A6D!important;display:inline-block;position:absolute}.MathJax_Hover_Arrow{position:absolute;width:15px;height:11px;cursor:pointer}#MathJax_About{position:fixed;left:50%;width:auto;text-align:center;border:3px outset;padding:1em 2em;background-color:#DDD;color:#000;cursor:default;font-family:message-box;font-size:120%;font-style:normal;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;border-radius:15px;-webkit-border-radius:15px;-moz-border-radius:15px;-khtml-border-radius:15px;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_Menu{position:absolute;background-color:#fff;color:#000;width:auto;padding:2px;border:1px solid #CCC;margin:0;cursor:default;font:menu;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;z-index:201;box-shadow:0 10px 20px gray;-webkit-box-shadow:0 10px 20px gray;-moz-box-shadow:0 10px 20px gray;-khtml-box-shadow:0 10px 20px gray;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}.MathJax_MenuItem{padding:2px 2em;background:0 0}.MathJax_MenuArrow{position:absolute;right:.5em;color:#666}.MathJax_MenuActive .MathJax_MenuArrow{color:#fff}.MathJax_MenuArrow.RTL{left:.5em;right:auto}.MathJax_MenuCheck{position:absolute;left:.7em}.MathJax_MenuCheck.RTL{right:.7em;left:auto}.MathJax_MenuRadioCheck{position:absolute;left:1em}.MathJax_MenuRadioCheck.RTL{right:1em;left:auto}.MathJax_MenuLabel{padding:2px 2em 4px 1.33em;font-style:italic}.MathJax_MenuRule{border-top:1px solid #CCC;margin:4px 1px 0}.MathJax_MenuDisabled{color:GrayText}.MathJax_MenuActive{background-color:Highlight;color:HighlightText}.MathJax_Menu_Close{position:absolute;width:31px;height:31px;top:-15px;left:-15px}#MathJax_Zoom{position:absolute;background-color:#F0F0F0;overflow:auto;display:block;z-index:301;padding:.5em;border:1px solid #000;margin:0;font-weight:400;font-style:normal;text-align:left;text-indent:0;text-transform:none;line-height:normal;letter-spacing:normal;word-spacing:normal;word-wrap:normal;white-space:nowrap;float:none;box-shadow:5px 5px 15px #AAA;-webkit-box-shadow:5px 5px 15px #AAA;-moz-box-shadow:5px 5px 15px #AAA;-khtml-box-shadow:5px 5px 15px #AAA;filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}#MathJax_ZoomOverlay{position:absolute;left:0;top:0;z-index:300;display:inline-block;width:100%;height:100%;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}#MathJax_ZoomFrame{position:relative;display:inline-block;height:0;width:0}#MathJax_ZoomEventTrap{position:absolute;left:0;top:0;z-index:302;display:inline-block;border:0;padding:0;margin:0;background-color:#fff;opacity:0;filter:alpha(opacity=0)}.MathJax_Preview{color:#888}#MathJax_Message{position:fixed;left:1px;bottom:2px;background-color:#E6E6E6;border:1px solid #959595;margin:0;padding:2px 8px;z-index:102;color:#000;font-size:80%;width:auto;white-space:nowrap}#MathJax_MSIE_Frame{position:absolute;top:0;left:0;width:0;z-index:101;border:0;margin:0;padding:0}.MathJax_Error{color:#C00;font-style:italic}footer{position:fixed;font-size:.8em;text-align:right;bottom:0;margin-left:-25px;height:20px;width:100%}</style>
</head>
<body class="markdown github">
<p class="toc" style="undefined"></p><ul>
<li><ul>
<li><span class="title">
<a href="#1.-基础知识" title="1. 基础知识">1. 基础知识</a>
</span>
<!--span class="number">
0
</span-->
<ul>
<li><span class="title">
<a href="#1.1-了解protocolbuffer3" title="1.1 了解protocolbuffer3">1.1 了解protocolbuffer3</a>
</span>
<!--span class="number">
1
</span-->
</li>
<li><span class="title">
<a href="#1.2-websocket和http" title="1.2 websocket和http">1.2 websocket和http</a>
</span>
<!--span class="number">
2
</span-->
</li>
<li><span class="title">
<a href="#1.3-交易执行的基本过程" title="1.3 交易执行的基本过程">1.3 交易执行的基本过程</a>
</span>
<!--span class="number">
3
</span-->
</li>
<li><span class="title">
<a href="#1.4-试一试" title="1.4 试一试">1.4 试一试</a>
</span>
<!--span class="number">
4
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#2-http接口" title="2 HTTP接口">2 HTTP接口</a>
</span>
<!--span class="number">
5
</span-->
<ul>
<li><span class="title">
<a href="#2.1-查询账号" title="2.1 查询账号">2.1 查询账号</a>
</span>
<!--span class="number">
6
</span-->
</li>
<li><span class="title">
<a href="#2.2-查询交易" title="2.2 查询交易">2.2 查询交易</a>
</span>
<!--span class="number">
7
</span-->
</li>
<li><span class="title">
<a href="#2.3-查询区块头" title="2.3 查询区块头">2.3 查询区块头</a>
</span>
<!--span class="number">
8
</span-->
</li>
<li><span class="title">
<a href="#2.4-提交交易" title="2.4 提交交易">2.4 提交交易</a>
</span>
<!--span class="number">
9
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#3-定义交易" title="3 定义交易">3 定义交易</a>
</span>
<!--span class="number">
10
</span-->
<ul>
<li><span class="title">
<a href="#操作码" title="操作码 ">操作码 </a>
</span>
<!--span class="number">
11
</span-->
</li>
<li><span class="title">
<a href="#3.1-操作" title="3.1 操作">3.1 操作</a>
</span>
<!--span class="number">
12
</span-->
<ul>
<li><span class="title">
<a href="#创建账号" title="创建账号">创建账号</a>
</span>
<!--span class="number">
13
</span-->
</li>
<li><span class="title">
<a href="#发行资产" title="发行资产">发行资产</a>
</span>
<!--span class="number">
14
</span-->
</li>
<li><span class="title">
<a href="#设置metadata" title="设置metadata">设置metadata</a>
</span>
<!--span class="number">
15
</span-->
</li>
<li><span class="title">
<a href="#转移资产" title="转移资产">转移资产</a>
</span>
<!--span class="number">
16
</span-->
</li>
<li><span class="title">
<a href="#设置权重" title="设置权重">设置权重</a>
</span>
<!--span class="number">
17
</span-->
</li>
<li><span class="title">
<a href="#设置门限" title="设置门限">设置门限</a>
</span>
<!--span class="number">
18
</span-->
</li>
</ul>
</li>
</ul>
</li>
<li><span class="title">
<a href="#4-高级功能" title="4 高级功能">4 高级功能</a>
</span>
<!--span class="number">
19
</span-->
<ul>
<li><span class="title">
<a href="#4.1-控制权的分配" title="4.1 控制权的分配">4.1 控制权的分配</a>
</span>
<!--span class="number">
20
</span-->
</li>
<li><span class="title">
<a href="#4.2-版本化控制" title="4.2 版本化控制">4.2 版本化控制</a>
</span>
<!--span class="number">
21
</span-->
</li>
<li><span class="title">
<a href="#4.3-表达式" title="4.3 表达式">4.3 表达式</a>
</span>
<!--span class="number">
22
</span-->
</li>
<li><span class="title">
<a href="#4.3-合约" title="4.3 合约">4.3 合约</a>
</span>
<!--span class="number">
23
</span-->
<ul>
<li><span class="title">
<a href="#4.3.1-内置函数" title="4.3.1 内置函数">4.3.1 内置函数</a>
</span>
<!--span class="number">
24
</span-->
<ul>
<li><span class="title">
<a href="#获取账号信息(不包含metada和资产)" title="获取账号信息(不包含metada和资产)">获取账号信息(不包含metada和资产)</a>
</span>
<!--span class="number">
25
</span-->
</li>
<li><span class="title">
<a href="#获取某个账号的metadata信息" title="获取某个账号的metadata信息">获取某个账号的metadata信息</a>
</span>
<!--span class="number">
26
</span-->
</li>
<li><span class="title">
<a href="#获取某个账号的资产信息" title="获取某个账号的资产信息">获取某个账号的资产信息</a>
</span>
<!--span class="number">
27
</span-->
</li>
<li><span class="title">
<a href="#获取区块信息" title="获取区块信息">获取区块信息</a>
</span>
<!--span class="number">
28
</span-->
</li>
<li><span class="title">
<a href="#做交易" title="做交易">做交易</a>
</span>
<!--span class="number">
29
</span-->
</li>
</ul>
</li>
<li><span class="title">
<a href="#4.3.2-内置变量" title="4.3.2 内置变量">4.3.2 内置变量</a>
</span>
<!--span class="number">
30
</span-->
<ul>
<li><span class="title">
<a href="#该合约账号的地址" title="该合约账号的地址">该合约账号的地址</a>
</span>
<!--span class="number">
31
</span-->
</li>
<li><span class="title">
<a href="#调用者的地址" title="调用者的地址">调用者的地址</a>
</span>
<!--span class="number">
32
</span-->
</li>
<li><span class="title">
<a href="#触发本次合约的交易" title="触发本次合约的交易">触发本次合约的交易</a>
</span>
<!--span class="number">
33
</span-->
</li>
<li><span class="title">
<a href="#触发本次合约调用的操作的序号" title="触发本次合约调用的操作的序号">触发本次合约调用的操作的序号</a>
</span>
<!--span class="number">
34
</span-->
</li>
<li><span class="title">
<a href="#本次共识数据" title="本次共识数据">本次共识数据</a>
</span>
<!--span class="number">
35
</span-->
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><span class="title">
<a href="#5.-错误码" title="5.  错误码">5.  错误码</a>
</span>
<!--span class="number">
36
</span-->
</li>
</ul>
</li>

</ul>
<p></p><h2 id="1.-基础知识"><a name="1.-基础知识" href="#1.-基础知识"></a>1. 基础知识</h2><h3 id="1.1-了解protocolbuffer3"><a name="1.1-了解protocolbuffer3" href="#1.1-了解protocolbuffer3"></a>1.1 了解protocolbuffer3</h3><p>布比区块链是用protocolbuffer3序列化数据的，protocolbuffer3是google推出的数据序列化协议，您如果不了解protocolbuffer3，请点击<a href="https://developers.google.com/protocol-buffers/docs/proto3">这里</a>了解更多。<br>我们使用的所有数据格式都能在源码的<code>src\proto</code>目录中找到。其中chain.proto文件中定义的数据是和交易、区块、账号密切相关的。</p><h3 id="1.2-websocket和http"><a name="1.2-websocket和http" href="#1.2-websocket和http"></a>1.2 websocket和http</h3><p>布比区块链提供了websocket和http 两种API接口。您可以在 安装目录/config/bubi.json 文件种找到<code>"webserver"</code>和<code>"wsserver"</code>两个对象,它们指定了http服务端口和websocket服务端口。</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>    &quot;webserver&quot;: 
    {
        &quot;listen_addresses&quot;: &quot;0.0.0.0:29333&quot;,
        &quot;remote_authorized&quot;: false
    },
    &quot;wsserver&quot;: 
    {
        &quot;listen_address&quot;: &quot;0.0.0.0:7053&quot;
    }
</code></pre>">    "webserver": 
    {
        "listen_addresses": "0.0.0.0:29333",
        "remote_authorized": false
    },
    "wsserver": 
    {
        "listen_address": "0.0.0.0:7053"
    }
</code></pre><h3 id="1.3-交易执行的基本过程"><a name="1.3-交易执行的基本过程" href="#1.3-交易执行的基本过程"></a>1.3 交易执行的基本过程</h3><ol>
<li>根据意愿组装交易对象<code>Transaction</code></li><li>交易对象序列化(protocolbuffer3格式)为字节流 <code>transaction_blob</code></li><li>用私钥<code>skey</code>对<code>transaction_blob</code>签名得到<code>sign_data</code>，<code>skey</code>的公钥为<code>pkey</code></li><li>提交交易，见<a href="#submitTransaction">提交交易</a></li><li>查询以确定交易是否成功或接收推送（websocket API）判断交易是否成功</li></ol><h3 id="1.4-试一试"><a name="1.4-试一试" href="#1.4-试一试"></a>1.4 试一试</h3><p>如果您的区块链刚刚部署完成，那么目前区块链系统中只有创世账号。您可以通过http接口查询创世账号<br><code>HTTP GET host:29333/getGenesisAccount</code><br>您会得到类似这样的返回内容</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
   &quot;error_code&quot; : 0,
   &quot;result&quot; :
   {
      &quot;address&quot; : &quot;a00254d4b61e2169f26c6f1614202f978e800c78e5e651&quot;,
      &quot;assets&quot; : null,
      &quot;balance&quot; : 100000000000000000,
      &quot;metadatas&quot; : null,
      &quot;priv&quot; : {
         &quot;master_weight&quot; : 1,
         &quot;thresholds&quot; : {
            &quot;tx_threshold&quot; : 1
         }
      }
   }
}
</code></pre>">{
   "<span class="hljs-attribute">error_code</span>" : <span class="hljs-value"><span class="hljs-number">0</span></span>,
   "<span class="hljs-attribute">result</span>" :
   <span class="hljs-value">{
      "<span class="hljs-attribute">address</span>" : <span class="hljs-value"><span class="hljs-string">"a00254d4b61e2169f26c6f1614202f978e800c78e5e651"</span></span>,
      "<span class="hljs-attribute">assets</span>" : <span class="hljs-value"><span class="hljs-literal">null</span></span>,
      "<span class="hljs-attribute">balance</span>" : <span class="hljs-value"><span class="hljs-number">100000000000000000</span></span>,
      "<span class="hljs-attribute">metadatas</span>" : <span class="hljs-value"><span class="hljs-literal">null</span></span>,
      "<span class="hljs-attribute">priv</span>" : <span class="hljs-value">{
         "<span class="hljs-attribute">master_weight</span>" : <span class="hljs-value"><span class="hljs-number">1</span></span>,
         "<span class="hljs-attribute">thresholds</span>" : <span class="hljs-value">{
            "<span class="hljs-attribute">tx_threshold</span>" : <span class="hljs-value"><span class="hljs-number">1</span>
         </span>}
      </span>}
   </span>}
</span>}
</code></pre><p>返回结果中的<code>address</code>的值就是创世账号。<br>您还可以通过<a href="#getAccount">查询账号</a>接口查询任意账号</p><pre class="http hljs"><code class="http" data-origin="<pre><code class=&quot;http&quot;>HTTP GET host:29333/getAccount?address=a00254d4b61e2169f26c6f1614202f978e800c78e5e651
</code></pre>">HTTP GET host:29333/getAccount?address=a00254d4b61e2169f26c6f1614202f978e800c78e5e651
</code></pre><h2 id="2-http接口"><a name="2-http接口" href="#2-http接口"></a>2 HTTP接口</h2><h3 id="2.1-查询账号"><a name="2.1-查询账号" href="#2.1-查询账号"></a>2.1 <span id="getAccount">查询账号</span></h3><pre class="http hljs"><code class="http" data-origin="<pre><code class=&quot;http&quot;>GET /getAccount?address=a002423c235a7ba9649347ff85b6be1c51980d1eff0398&amp;amp;key=hello&amp;amp;code=xxx&amp;amp;issuer=xxx
</code></pre>">GET /getAccount?address=a002423c235a7ba9649347ff85b6be1c51980d1eff0398&amp;key=hello&amp;code=xxx&amp;issuer=xxx
</code></pre><p>功能:返回指定账号的信息及其所有资产、metadata</p><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">address</td>
<td>账号地址， 必填</td>
</tr>
<tr>
<td style="text-align:left">key</td>
<td>账号的 metadata 中指定的key的值，如果不填写，那么返回结果中含有所有的metadata</td>
</tr>
<tr>
<td style="text-align:left">code, issuer</td>
<td>资产代码,资产发行商。这两个变量要么同时填写，要么同时不填写。若不填写，返回的结果中包含所有的资产。若填写，返回的结果中只显示由code和issuer指定的资产。</td>
</tr>
</tbody>
</table><p>返回内容</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
  &quot;error_code&quot; : 0,
  &quot;result&quot; : {
    &quot;address&quot; : &quot;a002423c235a7ba9649347ff85b6be1c51980d1eff0398&quot;,
    &quot;assets&quot; : [//该账号的所有资产
      {
        &quot;amount&quot; : 1400,
        &quot;property&quot; : 
        {
          &quot;code&quot; : &quot;CNY&quot;,
          &quot;issuer&quot; : &quot;a002423c235a7ba9649347ff85b6be1c51980d1eff0398&quot;
        }
      }, {
        &quot;amount&quot; : 1000,
        &quot;property&quot; : 
        {
          &quot;code&quot; : &quot;USD&quot;,
          &quot;issuer&quot; : &quot;a002423c235a7ba9649347ff85b6be1c51980d1eff0398&quot;
        }
      }
    ],
    &quot;assets_hash&quot; : &quot;9696b03e4c3169380882e0217a986717adfc5877b495068152e6aa25370ecf4a&quot;,
    &quot;contract&quot; : null,
    &quot;metadatas&quot; : [//该账号的所有metadata
      {
        &quot;key&quot; : &quot;123&quot;,
        &quot;value&quot; : &quot;123_value&quot;,
        &quot;version&quot; : 1
      }, {
        &quot;key&quot; : &quot;456&quot;,
        &quot;value&quot; : &quot;456_value&quot;,
        &quot;version&quot; : 1
      }, {
        &quot;key&quot; : &quot;abcd&quot;,
        &quot;value&quot; : &quot;abcd_value&quot;,
        &quot;version&quot; : 1
      }
    ],
    &quot;nonce&quot; : 1, //账号当前作为交易源执行过的交易数量。若nonce为0，该字段不显示
    &quot;priv&quot; : {
      &quot;master_weight&quot; : &quot;1&quot;,
      &quot;thresholds&quot; : {
        &quot;tx_threshold&quot; : &quot;1&quot;
      }
    },
    &quot;storage_hash&quot; : &quot;82c8407cc7cd77897be3100c47ed9d43ec4097ee1c00e2c13447187e5b1ac66c&quot;
  }
}
</code></pre>">{
  "error_code" : 0,
  "result" : {
    "address" : "a002423c235a7ba9649347ff85b6be1c51980d1eff0398",
    "assets" : [//该账号的所有资产
      {
        "amount" : 1400,
        "property" : 
        {
          "code" : "CNY",
          "issuer" : "a002423c235a7ba9649347ff85b6be1c51980d1eff0398"
        }
      }, {
        "amount" : 1000,
        "property" : 
        {
          "code" : "USD",
          "issuer" : "a002423c235a7ba9649347ff85b6be1c51980d1eff0398"
        }
      }
    ],
    "assets_hash" : "9696b03e4c3169380882e0217a986717adfc5877b495068152e6aa25370ecf4a",
    "contract" : null,
    "metadatas" : [//该账号的所有metadata
      {
        "key" : "123",
        "value" : "123_value",
        "version" : 1
      }, {
        "key" : "456",
        "value" : "456_value",
        "version" : 1
      }, {
        "key" : "abcd",
        "value" : "abcd_value",
        "version" : 1
      }
    ],
    "nonce" : 1, //账号当前作为交易源执行过的交易数量。若nonce为0，该字段不显示
    "priv" : {
      "master_weight" : "1",
      "thresholds" : {
        "tx_threshold" : "1"
      }
    },
    "storage_hash" : "82c8407cc7cd77897be3100c47ed9d43ec4097ee1c00e2c13447187e5b1ac66c"
  }
}
</code></pre><ul>
<li>如果该账号不存在,则返回内容</li></ul><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
   &quot;error_code&quot; : 4,
   &quot;result&quot; : null
}
</code></pre>">{
   "<span class="hljs-attribute">error_code</span>" : <span class="hljs-value"><span class="hljs-number">4</span></span>,
   "<span class="hljs-attribute">result</span>" : <span class="hljs-value"><span class="hljs-literal">null</span>
</span>}
</code></pre><h3 id="2.2-查询交易"><a name="2.2-查询交易" href="#2.2-查询交易"></a>2.2 查询交易</h3><pre class="http hljs"><code class="http" data-origin="<pre><code class=&quot;http&quot;>GET /getTransactionHistory?hash=ad545bfc26c440e324076fbbe1d8affbd8a2277858dc35927d425d0fe644e698&amp;amp;ledger_seq=2
</code></pre>">GET /getTransactionHistory?hash=ad545bfc26c440e324076fbbe1d8affbd8a2277858dc35927d425d0fe644e698&amp;ledger_seq=2
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">hash</td>
<td>用交易的唯一标识hash查询</td>
</tr>
<tr>
<td style="text-align:left">ledger_seq</td>
<td>查询指定区块中的所有交易</td>
</tr>
</tbody>
</table><p>上述两个参数产生的约束条件是逻辑与的关系，如果您同时指定两个参数，系统将在指定的区块中查询指定的交易</p><p>返回示例</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
  &quot;error_code&quot;: 0,
  &quot;result&quot;:
  {
    &quot;total_count&quot;: 1,
    &quot;transactions&quot;: [
      {
        &quot;close_time&quot;: 1506309263293181,
        &quot;error_code&quot;: 0,
        &quot;hash&quot;: &quot;befe04be90d46fa8963d2fc2792d96e875995dc60734d6a6eb70392e49316ec0&quot;,
        &quot;ledger_seq&quot;: 2,
        &quot;signatures&quot;: [
          {
            &quot;public_key&quot;: &quot;b00204f82f1cc166e933b9829b4d6780ac2905f0f174bffc8e64bee5139f3dc9b3efe35041b89047152d468f26b6f490daf61244a101e0c78463f7b97153c7a8dbd3aaa9&quot;,
            &quot;sign_data&quot;: &quot;f7e87e461bc0a0ebba06aa236926f5fc6a3812a0d5d0f3a0e2268b32dd60dae57df339dbfbbea302e95a39cca6291bb80b59fe58788f33f99e00b1b3c12487ff&quot;
          },
          {
            &quot;public_key&quot;: &quot;b002042ad76c8d526e6cb1bc2cd28214fd433eb1255018c1437f0bf2b081041309d6d5bb21c96292069f6ce760dab50883ca6b3fc478c9bb5ef6256717f6b31dd64eb2fe&quot;,
            &quot;sign_data&quot;: &quot;5478176325912dd6861748211f6ff51d6e49ab5c394a79112f6c656729637e33e6e9f14529d782ae3099f342ccfd3fc498d098e6f1c50a2a251262ffc1ab30aa&quot;
          },
          {
            &quot;public_key&quot;: &quot;b00204e6e93bf0c8e0b2e0099cd54a677bcbeefa888c6bad992f55c05ba7f8169286963ae6968fc48c3c6b6a65827f2e9d604176a17919dfc665e8ea78a461c518757bb9&quot;,
            &quot;sign_data&quot;: &quot;7cabec78bdb8dbbd1e6fd7ac4c790280f59248a459e216c6902c444fa582008c770145225e00c9ac6b8d53c9851ac6fc7665af0a05f9e61d77597a2e80803381&quot;
          }
        ],
        &quot;transaction&quot;:
        {
          &quot;nonce&quot;: 1,
          &quot;operations&quot;: [
            {
              &quot;create_account&quot;:
              {
                &quot;dest_address&quot;: &quot;a002fc445b8cec48783c7cdb49f69c67dc75893d053362&quot;,
                &quot;metadatas&quot;: [
                  {
                    &quot;key&quot;: &quot;role&quot;,
                    &quot;value&quot;: &quot;我是货主&quot;
                  }
                ],
                &quot;priv&quot;:
                {
                  &quot;master_weight&quot;: 10,
                  &quot;thresholds&quot;:
                  {
                    &quot;tx_threshold&quot;: 7
                  }
                }
              },
              &quot;type&quot;: 1
            },
            {
              &quot;create_account&quot;:
              {
                &quot;dest_address&quot;: &quot;a0025d8de2df8fa30a112f05c30ba4ecbd83975843d260&quot;,
                &quot;metadatas&quot;: [
                  {
                    &quot;key&quot;: &quot;role&quot;,
                    &quot;value&quot;: &quot;我是操作员&quot;
                  }
                ],
                &quot;priv&quot;:
                {
                  &quot;master_weight&quot;: 10,
                  &quot;thresholds&quot;:
                  {
                    &quot;tx_threshold&quot;: 7
                  }
                }
              },
              &quot;type&quot;: 1
            }
          ],
          &quot;source_address&quot;: &quot;a00254d4b61e2169f26c6f1614202f978e800c78e5e651&quot;
        }
      }
    ]
  }
}
</code></pre>">{
  "<span class="hljs-attribute">error_code</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
  "<span class="hljs-attribute">result</span>":
  <span class="hljs-value">{
    "<span class="hljs-attribute">total_count</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
    "<span class="hljs-attribute">transactions</span>": <span class="hljs-value">[
      {
        "<span class="hljs-attribute">close_time</span>": <span class="hljs-value"><span class="hljs-number">1506309263293181</span></span>,
        "<span class="hljs-attribute">error_code</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
        "<span class="hljs-attribute">hash</span>": <span class="hljs-value"><span class="hljs-string">"befe04be90d46fa8963d2fc2792d96e875995dc60734d6a6eb70392e49316ec0"</span></span>,
        "<span class="hljs-attribute">ledger_seq</span>": <span class="hljs-value"><span class="hljs-number">2</span></span>,
        "<span class="hljs-attribute">signatures</span>": <span class="hljs-value">[
          {
            "<span class="hljs-attribute">public_key</span>": <span class="hljs-value"><span class="hljs-string">"b00204f82f1cc166e933b9829b4d6780ac2905f0f174bffc8e64bee5139f3dc9b3efe35041b89047152d468f26b6f490daf61244a101e0c78463f7b97153c7a8dbd3aaa9"</span></span>,
            "<span class="hljs-attribute">sign_data</span>": <span class="hljs-value"><span class="hljs-string">"f7e87e461bc0a0ebba06aa236926f5fc6a3812a0d5d0f3a0e2268b32dd60dae57df339dbfbbea302e95a39cca6291bb80b59fe58788f33f99e00b1b3c12487ff"</span>
          </span>},
          {
            "<span class="hljs-attribute">public_key</span>": <span class="hljs-value"><span class="hljs-string">"b002042ad76c8d526e6cb1bc2cd28214fd433eb1255018c1437f0bf2b081041309d6d5bb21c96292069f6ce760dab50883ca6b3fc478c9bb5ef6256717f6b31dd64eb2fe"</span></span>,
            "<span class="hljs-attribute">sign_data</span>": <span class="hljs-value"><span class="hljs-string">"5478176325912dd6861748211f6ff51d6e49ab5c394a79112f6c656729637e33e6e9f14529d782ae3099f342ccfd3fc498d098e6f1c50a2a251262ffc1ab30aa"</span>
          </span>},
          {
            "<span class="hljs-attribute">public_key</span>": <span class="hljs-value"><span class="hljs-string">"b00204e6e93bf0c8e0b2e0099cd54a677bcbeefa888c6bad992f55c05ba7f8169286963ae6968fc48c3c6b6a65827f2e9d604176a17919dfc665e8ea78a461c518757bb9"</span></span>,
            "<span class="hljs-attribute">sign_data</span>": <span class="hljs-value"><span class="hljs-string">"7cabec78bdb8dbbd1e6fd7ac4c790280f59248a459e216c6902c444fa582008c770145225e00c9ac6b8d53c9851ac6fc7665af0a05f9e61d77597a2e80803381"</span>
          </span>}
        ]</span>,
        "<span class="hljs-attribute">transaction</span>":
        <span class="hljs-value">{
          "<span class="hljs-attribute">nonce</span>": <span class="hljs-value"><span class="hljs-number">1</span></span>,
          "<span class="hljs-attribute">operations</span>": <span class="hljs-value">[
            {
              "<span class="hljs-attribute">create_account</span>":
              <span class="hljs-value">{
                "<span class="hljs-attribute">dest_address</span>": <span class="hljs-value"><span class="hljs-string">"a002fc445b8cec48783c7cdb49f69c67dc75893d053362"</span></span>,
                "<span class="hljs-attribute">metadatas</span>": <span class="hljs-value">[
                  {
                    "<span class="hljs-attribute">key</span>": <span class="hljs-value"><span class="hljs-string">"role"</span></span>,
                    "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"我是货主"</span>
                  </span>}
                ]</span>,
                "<span class="hljs-attribute">priv</span>":
                <span class="hljs-value">{
                  "<span class="hljs-attribute">master_weight</span>": <span class="hljs-value"><span class="hljs-number">10</span></span>,
                  "<span class="hljs-attribute">thresholds</span>":
                  <span class="hljs-value">{
                    "<span class="hljs-attribute">tx_threshold</span>": <span class="hljs-value"><span class="hljs-number">7</span>
                  </span>}
                </span>}
              </span>}</span>,
              "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-number">1</span>
            </span>},
            {
              "<span class="hljs-attribute">create_account</span>":
              <span class="hljs-value">{
                "<span class="hljs-attribute">dest_address</span>": <span class="hljs-value"><span class="hljs-string">"a0025d8de2df8fa30a112f05c30ba4ecbd83975843d260"</span></span>,
                "<span class="hljs-attribute">metadatas</span>": <span class="hljs-value">[
                  {
                    "<span class="hljs-attribute">key</span>": <span class="hljs-value"><span class="hljs-string">"role"</span></span>,
                    "<span class="hljs-attribute">value</span>": <span class="hljs-value"><span class="hljs-string">"我是操作员"</span>
                  </span>}
                ]</span>,
                "<span class="hljs-attribute">priv</span>":
                <span class="hljs-value">{
                  "<span class="hljs-attribute">master_weight</span>": <span class="hljs-value"><span class="hljs-number">10</span></span>,
                  "<span class="hljs-attribute">thresholds</span>":
                  <span class="hljs-value">{
                    "<span class="hljs-attribute">tx_threshold</span>": <span class="hljs-value"><span class="hljs-number">7</span>
                  </span>}
                </span>}
              </span>}</span>,
              "<span class="hljs-attribute">type</span>": <span class="hljs-value"><span class="hljs-number">1</span>
            </span>}
          ]</span>,
          "<span class="hljs-attribute">source_address</span>": <span class="hljs-value"><span class="hljs-string">"a00254d4b61e2169f26c6f1614202f978e800c78e5e651"</span>
        </span>}
      </span>}
    ]
  </span>}
</span>}
</code></pre><p>如果没有查到交易则返回</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
  &quot;error_code&quot;: 4,
  &quot;result&quot;:
  {
    &quot;total_count&quot;: 0,
    &quot;transactions&quot;: []
  }
}
</code></pre>">{
  "<span class="hljs-attribute">error_code</span>": <span class="hljs-value"><span class="hljs-number">4</span></span>,
  "<span class="hljs-attribute">result</span>":
  <span class="hljs-value">{
    "<span class="hljs-attribute">total_count</span>": <span class="hljs-value"><span class="hljs-number">0</span></span>,
    "<span class="hljs-attribute">transactions</span>": <span class="hljs-value">[]
  </span>}
</span>}
</code></pre><h3 id="2.3-查询区块头"><a name="2.3-查询区块头" href="#2.3-查询区块头"></a>2.3 查询区块头</h3><pre class="http hljs"><code class="http" data-origin="<pre><code class=&quot;http&quot;>GET /getLedger?seq=xxxx&amp;amp;with_validator=true&amp;amp;with_consvalue=true
</code></pre>">GET /getLedger?seq=xxxx&amp;with_validator=true&amp;with_consvalue=true
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">seq</td>
<td>ledger的序号， 如果不填写，返回当前ledger</td>
</tr>
<tr>
<td style="text-align:left">with_validator</td>
<td>true or false，是否显示验证节点列表</td>
</tr>
<tr>
<td style="text-align:left">with_consvalue</td>
<td>true or fasse，是否显示共识值</td>
</tr>
</tbody>
</table><ul>
<li>如果查询到ledger则返回内容:</li></ul><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
   &quot;error_code&quot; : 0,
   &quot;result&quot; : {
      &quot;consensus_value&quot; : {//with_consvalue为true时才出现
         &quot;close_time&quot; : 1506309624837046,
         &quot;ledger_seq&quot; : 12,
         &quot;previous_ledger_hash&quot; : &quot;ff7670d9e201bef7f0c0ab06e63d643d2eb908d7583c1c873d189fdb5afd5352&quot;,
         &quot;previous_proof&quot; : &quot;0afc010a2a080110022a24100b2220335c1fecca46814f86fe1fcc783910dbe5bd8997e3d0960128e858ff9d64868912cd010a8801623030323034316136633636343233373139373465613061663862366636393136353230343964366262396539653363663739383363363763613362336563616538363337346565306465616665666563393432383138303936613335313335343635373861346632643761623664353133396339323737656264306634633931623563643739641240c6c419163607620c248912928693e606170ba151b79795d3e3e932884df7cd4e91f1dc17c33f616db0d51354b10628d27573cb8bdd4128b3e5c71fc50b75e584&quot;,
         &quot;previous_proof_plain&quot; : {
            &quot;commits&quot; : [
               {
                  &quot;pbft&quot; : {
                     &quot;commit&quot; : {
                        &quot;sequence&quot; : 11,
                        &quot;value_digest&quot; : &quot;335c1fecca46814f86fe1fcc783910dbe5bd8997e3d0960128e858ff9d648689&quot;
                     },
                     &quot;round_number&quot; : 1,
                     &quot;type&quot; : 2
                  },
                  &quot;signature&quot; : {
                     &quot;public_key&quot; : &quot;b002041a6c6642371974ea0af8b6f691652049d6bb9e9e3cf7983c67ca3b3ecae86374ee0deafefec942818096a3513546578a4f2d7ab6d5139c9277ebd0f4c91b5cd79d&quot;,
                     &quot;sign_data&quot; : &quot;c6c419163607620c248912928693e606170ba151b79795d3e3e932884df7cd4e91f1dc17c33f616db0d51354b10628d27573cb8bdd4128b3e5c71fc50b75e584&quot;
                  }
               }
            ]
         },
         &quot;txset&quot; : null
      },
      &quot;header&quot; : {
         &quot;account_tree_hash&quot; : &quot;4fa53174df6c4d1d0410cbd1ee4c60d99ee884cc1e095bee4b633f1bada240d5&quot;,//账号树的根hash
         &quot;close_time&quot; : 1506309624837046,//区块生成时间
         &quot;consensus_value_hash&quot; ://共识值的hash &quot;20a83a0522374368090e0c46d64f081c3404ac71975f288a2e7a90a3b01b302d&quot;,
         &quot;hash&quot; : &quot;f8edfa81c9b45bb47fa49c90f784558b78ad4a243367c6cb8c6972dac4a0f9b7&quot;,//本区块hash
         &quot;previous_hash&quot; ://上个区块hash &quot;ff7670d9e201bef7f0c0ab06e63d643d2eb908d7583c1c873d189fdb5afd5352&quot;,
         &quot;seq&quot; : 12,//区块的序号
         &quot;tx_count&quot; : 1,//截至到本区块，已经产生的所有交易个数
         &quot;validators_hash&quot; ://共识节点集合hash &quot;b744ccae0ecd1b0c09923564bc1556949e96f78755bdbcec06a82ddad420cca4&quot;,
         &quot;version&quot; : 3000//区块版本号
      },
      &quot;validators&quot; : [//with_validator为true时才出现
          &quot;a002953b57b025662c9f9de93df4c319cc39bec181c2b5&quot; 
      ]
   }
}
</code></pre>">{
   "error_code" : 0,
   "result" : {
      "consensus_value" : {//with_consvalue为true时才出现
         "close_time" : 1506309624837046,
         "ledger_seq" : 12,
         "previous_ledger_hash" : "ff7670d9e201bef7f0c0ab06e63d643d2eb908d7583c1c873d189fdb5afd5352",
         "previous_proof" : "0afc010a2a080110022a24100b2220335c1fecca46814f86fe1fcc783910dbe5bd8997e3d0960128e858ff9d64868912cd010a8801623030323034316136633636343233373139373465613061663862366636393136353230343964366262396539653363663739383363363763613362336563616538363337346565306465616665666563393432383138303936613335313335343635373861346632643761623664353133396339323737656264306634633931623563643739641240c6c419163607620c248912928693e606170ba151b79795d3e3e932884df7cd4e91f1dc17c33f616db0d51354b10628d27573cb8bdd4128b3e5c71fc50b75e584",
         "previous_proof_plain" : {
            "commits" : [
               {
                  "pbft" : {
                     "commit" : {
                        "sequence" : 11,
                        "value_digest" : "335c1fecca46814f86fe1fcc783910dbe5bd8997e3d0960128e858ff9d648689"
                     },
                     "round_number" : 1,
                     "type" : 2
                  },
                  "signature" : {
                     "public_key" : "b002041a6c6642371974ea0af8b6f691652049d6bb9e9e3cf7983c67ca3b3ecae86374ee0deafefec942818096a3513546578a4f2d7ab6d5139c9277ebd0f4c91b5cd79d",
                     "sign_data" : "c6c419163607620c248912928693e606170ba151b79795d3e3e932884df7cd4e91f1dc17c33f616db0d51354b10628d27573cb8bdd4128b3e5c71fc50b75e584"
                  }
               }
            ]
         },
         "txset" : null
      },
      "header" : {
         "account_tree_hash" : "4fa53174df6c4d1d0410cbd1ee4c60d99ee884cc1e095bee4b633f1bada240d5",//账号树的根hash
         "close_time" : 1506309624837046,//区块生成时间
         "consensus_value_hash" ://共识值的hash "20a83a0522374368090e0c46d64f081c3404ac71975f288a2e7a90a3b01b302d",
         "hash" : "f8edfa81c9b45bb47fa49c90f784558b78ad4a243367c6cb8c6972dac4a0f9b7",//本区块hash
         "previous_hash" ://上个区块hash "ff7670d9e201bef7f0c0ab06e63d643d2eb908d7583c1c873d189fdb5afd5352",
         "seq" : 12,//区块的序号
         "tx_count" : 1,//截至到本区块，已经产生的所有交易个数
         "validators_hash" ://共识节点集合hash "b744ccae0ecd1b0c09923564bc1556949e96f78755bdbcec06a82ddad420cca4",
         "version" : 3000//区块版本号
      },
      "validators" : [//with_validator为true时才出现
          "a002953b57b025662c9f9de93df4c319cc39bec181c2b5" 
      ]
   }
}
</code></pre><ul>
<li>如果没有查询到ledger返回的内容:</li></ul><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
   &quot;error_code&quot; : 4,
   &quot;result&quot; : null
}
</code></pre>">{
   "<span class="hljs-attribute">error_code</span>" : <span class="hljs-value"><span class="hljs-number">4</span></span>,
   "<span class="hljs-attribute">result</span>" : <span class="hljs-value"><span class="hljs-literal">null</span>
</span>}
</code></pre><h3 id="2.4-提交交易"><a name="2.4-提交交易" href="#2.4-提交交易"></a>2.4 <span id="submitTransaction">提交交易</span></h3><pre class="http hljs"><code class="http" data-origin="<pre><code class=&quot;http&quot;>POST /submitTransaction
</code></pre>">POST /submitTransaction
</code></pre><p>数据格式</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
  &quot;items&quot; : [{
      &quot;transaction_blob&quot; : &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;,
      &quot;signatures&quot; : [{
          &quot;sign_data&quot; : &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;,
          &quot;public_key&quot; : &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
        }, {
          &quot;sign_data&quot; : &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;,
          &quot;public_key&quot; : &quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;
        }
      ]
    }
  ]
}
</code></pre>">{
  "<span class="hljs-attribute">items</span>" : <span class="hljs-value">[{
      "<span class="hljs-attribute">transaction_blob</span>" : <span class="hljs-value"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span></span>,
      "<span class="hljs-attribute">signatures</span>" : <span class="hljs-value">[{
          "<span class="hljs-attribute">sign_data</span>" : <span class="hljs-value"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span></span>,
          "<span class="hljs-attribute">public_key</span>" : <span class="hljs-value"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
        </span>}, {
          "<span class="hljs-attribute">sign_data</span>" : <span class="hljs-value"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span></span>,
          "<span class="hljs-attribute">public_key</span>" : <span class="hljs-value"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>
        </span>}
      ]
    </span>}
  ]
</span>}
</code></pre><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">transaction_blob</td>
<td>交易序列化之后的16进制格式。您可以参照<a href="#defTransaction">定义交易</a>来组装自己的交易数据</td>
</tr>
<tr>
<td style="text-align:left">sign_data</td>
<td>签名数据， 16进制格式。其值为对transaction_blob进行签名(动词)得到的签名数据。</td>
</tr>
<tr>
<td style="text-align:left">public_key</td>
<td>公钥， 16进制格式。</td>
</tr>
</tbody>
</table><h2 id="3-定义交易"><a name="3-定义交易" href="#3-定义交易"></a>3 <span id="defTransaction">定义交易</span></h2><p>相关的protocolbuffer的数据格式</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>//交易
message Transaction
{
    enum Limit{
            UNKNOWN = 0;
            OPERATIONS = 1000;
    };
    string source_address = 1;
    int64 nonce = 2;
    string expr_condition = 3;
    repeated Operation operations = 4;
    bytes metadata = 5;
    int64  fee = 6;
}

//操作父类
message Operation
{
    enum Type {
        UNKNOWN = 0;
        CREATE_ACCOUNT = 1;
        ISSUE_ASSET = 2;
        PAYMENT = 3;
        SET_METADATA = 4;
        SET_SIGNER_WEIGHT = 5;
        SET_THRESHOLD = 6;
        PAY_COIN = 7;
    };
    Type type = 1;
    string source_address = 2;
    bytes metadata    = 3;
    string expr_condition = 4;

    OperationCreateAccount create_account = 5;
    OperationIssueAsset issue_asset = 6;
    OperationPayment payment = 7;
    OperationSetMetadata set_metadata = 9;
    OperationSetSignerWeight set_signer_weight = 10;
    OperationSetThreshold set_threshold = 11;
    OperationPayCoin pay_coin = 12;
}
</code></pre>">//交易
message Transaction
{
    enum Limit{
            UNKNOWN = 0;
            OPERATIONS = 1000;
    };
    string source_address = 1;
    int64 nonce = 2;
    string expr_condition = 3;
    repeated Operation operations = 4;
    bytes metadata = 5;
    int64  fee = 6;
}

//操作父类
message Operation
{
    enum Type {
        UNKNOWN = 0;
        CREATE_ACCOUNT = 1;
        ISSUE_ASSET = 2;
        PAYMENT = 3;
        SET_METADATA = 4;
        SET_SIGNER_WEIGHT = 5;
        SET_THRESHOLD = 6;
        PAY_COIN = 7;
    };
    Type type = 1;
    string source_address = 2;
    bytes metadata    = 3;
    string expr_condition = 4;

    OperationCreateAccount create_account = 5;
    OperationIssueAsset issue_asset = 6;
    OperationPayment payment = 7;
    OperationSetMetadata set_metadata = 9;
    OperationSetSignerWeight set_signer_weight = 10;
    OperationSetThreshold set_threshold = 11;
    OperationPayCoin pay_coin = 12;
}
</code></pre><p>交易Transaction有5个关键字段</p><ul>
<li><p>source_address: 交易源账号，即交易发起方的账号。当这笔交易成功后，交易源账号的nonce字段会自动加1。账号中的nonce意义是本账号作为交易源执行过的交易数量。</p>
</li><li><p>nonce：其值必须等于交易源账号的当前nonce+1，这是为了防止重放攻击而设计的。如何查询一个账号的nonce可参考<a href="#getAccount">查询账号</a>。若查询账号没有显示nonce值，说明账号的当前nonce是0.</p>
</li><li><p>expr_condition：针对本交易的表达式，高级功能。详见<a href="#condition">表达式</a></p>
</li><li><p>operations：操作列表。本交易的有效负载，即本交易想要做什么事情。见<a href="#operation">操作</a></p>
</li><li><p>metadata：用户自定义字段，可以不填写，备注用。</p>
</li></ul><p>Operation是所有操作的父类：</p><ul>
<li><p>type: 操作类型的枚举。如其值为ISSUE_ASSET（发行资产），那么本操作中的issue_asset字段就会被使用；如果其值为PAYMENT，那么本操作中payment字段就会被使用……详见<a href="#OPERATION_CODE">操作码</a></p>
</li><li><p>source_address：操作源，即本操作针对哪个账号生效。若不填写，则默认本操作源等于本操作源。</p>
</li><li>metadata：本操作的备注，用户自定义，可以不填写</li><li>expr_condition：针对本操作的表达式，若您用不着这个功能，可以不填写。详见<a href="#condition">表达式</a></li></ul><h3 id="操作码"><a name="操作码" href="#操作码"></a><span id="OPERATION_CODE">操作码 </span></h3><table>
<thead>
<tr>
<th style="text-align:left">代码</th>
<th>枚举名</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td>CREATE_ACCOUNT</td>
<td>创建账号</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td>ISSUE_ASSET</td>
<td>发行资产</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td>PAYMENT</td>
<td>转移资产</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td>SET_METADATA</td>
<td>设置metadata</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td>SET_SIGNER_WEIGHT</td>
<td>设置权重</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td>SET_THRESHOLD</td>
<td>设置门限</td>
</tr>
</tbody>
</table><h3 id="3.1-操作"><a name="3.1-操作" href="#3.1-操作"></a>3.1 <span id="operation">操作</span></h3><h4 id="创建账号"><a name="创建账号" href="#创建账号"></a>创建账号</h4><ul>
<li>功能<br>在区块链上创建一个新的账号</li><li><p>成功条件</p>
<ul>
<li>各项参数合法</li><li>要创建的账号不存在</li></ul>
</li><li><p>protocol结构定义</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>  message OperationCreateAccount
  {
      string dest_address = 1;
      Contract contract = 2;
      AccountPrivilege priv = 3;
      repeated KeyPair metadatas = 4;    
      int64    init_balance = 5;
  }
</code></pre>">  message OperationCreateAccount
  {
      string dest_address = 1;
      Contract contract = 2;
      AccountPrivilege priv = 3;
      repeated KeyPair metadatas = 4;    
      int64    init_balance = 5;
  }
</code></pre>
<ul>
<li>dest_address：要创建的账号的地址</li><li>contract:合约。若你想要创建一个不具有合约功能的账号，可以不填写这部分。若您想创建具有合约功能的账号，请参照<a href="#contract">合约</a></li><li><p>priv：账号的初始权力分配。相关的数据结构定义：</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>  message OperationTypeThreshold
  {
      Operation.Type type = 1;
      int64 threshold = 2;
  }

  message AccountPrivilege 
  {
      int64 master_weight = 1;
      repeated Signer signers = 2;
      AccountThreshold thresholds = 3;
  }
  message Signer
  {
      enum Limit{
          SIGNER_NONE = 0;
          SIGNER = 100;
      };
      string address = 1;
      int64 weight = 2;
  }
  message AccountThreshold
  {
      int64 tx_threshold = 1; //required, [-1,MAX(INT64)] -1: 表示不设置
      repeated OperationTypeThreshold type_thresholds = 2; //如果这个设置，则操作门限以这个为准
  }
</code></pre>">  message OperationTypeThreshold
  {
      Operation.Type type = 1;
      int64 threshold = 2;
  }

  message AccountPrivilege 
  {
      int64 master_weight = 1;
      repeated Signer signers = 2;
      AccountThreshold thresholds = 3;
  }
  message Signer
  {
      enum Limit{
          SIGNER_NONE = 0;
          SIGNER = 100;
      };
      string address = 1;
      int64 weight = 2;
  }
  message AccountThreshold
  {
      int64 tx_threshold = 1; //required, [-1,MAX(INT64)] -1: 表示不设置
      repeated OperationTypeThreshold type_thresholds = 2; //如果这个设置，则操作门限以这个为准
  }
</code></pre>
<p>若你想创建一个不受其他账号控制的账号。将priv.master_weight设置为1，将priv.thresholds.tx_threshold设为1即可。若您想创建一个受其他账号控制的账号，参见<a href="#power">控制权分配</a></p>
</li><li>metadatas：metadata列表。您可以为新建的账号设置一批初始的metadata。其数据类型为KeyPair,结构如下<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>message KeyPair
{
  string key = 1;
  string value = 2;
  int64 version = 3;
}
</code></pre>">message KeyPair
{
  string key = 1;
  string value = 2;
  int64 version = 3;
}
</code></pre>
这是一个版本化的键值对数据库，如果您不需要，可以不填写这部分。</li><li>init_balance:暂时未启用</li></ul>
</li></ul><h4 id="发行资产"><a name="发行资产" href="#发行资产"></a>发行资产</h4><ul>
<li>功能<br>操作源账号发行一笔数字资产，执行成功后操作源账号的资产余额中会出现这一笔资产</li><li><p>成功条件</p>
<ul>
<li>各项参数合法</li><li>资产数量没有溢出（int64）</li></ul>
</li><li><p>protocol结构定义</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>  message OperationIssueAsset
  {
      string code = 1;
      int64 amount = 2;
  }
</code></pre>">  message OperationIssueAsset
  {
      string code = 1;
      int64 amount = 2;
  }
</code></pre>
<ul>
<li>code:要发行的资产代码，长度范围[1, 64]</li><li>发行的数量。数值范围(0,MAX(int64))<br>成功条件<br>执行成功后，操作源的资产表中会出现这部分新发行的资产</li></ul>
</li></ul><h4 id="设置metadata"><a name="设置metadata" href="#设置metadata"></a>设置metadata</h4><ul>
<li>功能<br>操作源账号修改或添加一个metadata到自己的metadata表中</li><li><p>成功条件</p>
<ul>
<li>各项参数合法</li></ul>
</li><li><p>protocol结构定义</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>  message OperationSetMetadata
  {
      string key = 1;
      string value = 2;
      int64 version = 3;
  }
</code></pre>">  message OperationSetMetadata
  {
      string key = 1;
      string value = 2;
      int64 version = 3;
  }
</code></pre>
<ul>
<li>key: 主键，账号内唯一。长度范围[1,1024]</li><li>value: 值。长度范围[0,1M]</li><li>version: 版本号，可以不填写。若您想使用这个高级功能，参见<a href="#version">版本化控制</a></li></ul>
</li></ul><h4 id="转移资产"><a name="转移资产" href="#转移资产"></a>转移资产</h4><ul>
<li>功能<br>操作源账号将一笔资产转给目标账号</li><li><p>成功条件</p>
<ul>
<li>各项参数合法</li><li>源账号该类型的资产数量足够</li></ul>
</li><li><p>protocol结构定义</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>  message OperationPayment
  {
      string dest_address = 1;

      Asset asset = 2;

      string input = 3;
  }
</code></pre>">  message OperationPayment
  {
      string dest_address = 1;

      Asset asset = 2;

      string input = 3;
  }
</code></pre>
<ul>
<li>dest_address: 资产接收方账号地址</li><li><p>asset: 要转移的资产</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>message Asset
{
   AssetProperty property = 1; //资产属性
   int64 amount = 2; //数量
}

message AssetProperty
{
   string issuer = 1; //资产发行方
   string code = 2; //资产代码
}
</code></pre>">message Asset
{
   AssetProperty property = 1; //资产属性
   int64 amount = 2; //数量
}

message AssetProperty
{
   string issuer = 1; //资产发行方
   string code = 2; //资产代码
}
</code></pre>
</li><li>input: 本次转移触发接收方的合约，合约的执行入参就是input</li></ul>
</li></ul><h4 id="设置权重"><a name="设置权重" href="#设置权重"></a>设置权重</h4><ul>
<li>功能<br>设置签名者拥有的权重</li><li><p>成功条件</p>
<ul>
<li>各项参数合法</li></ul>
</li><li><p>protocol结构定义</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>  message OperationSetSignerWeight
  {
       int64 master_weight = 1; //required, [-1,MAX(UINT32)] -1: 表示不设置
       repeated Signer signers = 2; //address:weight, 如果weight 为0 表示删除这个signer
  }
</code></pre>">  message OperationSetSignerWeight
  {
       int64 master_weight = 1; //required, [-1,MAX(UINT32)] -1: 表示不设置
       repeated Signer signers = 2; //address:weight, 如果weight 为0 表示删除这个signer
  }
</code></pre>
<ul>
<li>master_weight：本账号地址拥有的权力值</li><li>各个签名者的权力值, Singer的定义如下<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>message Signer 
{
enum Limit{
      SIGNER_NONE = 0;
      SIGNER = 100;
};
   string address = 1;
   int64 weight = 2;
}
</code></pre>">message Signer 
{
enum Limit{
      SIGNER_NONE = 0;
      SIGNER = 100;
};
   string address = 1;
   int64 weight = 2;
}
</code></pre>
</li></ul>
</li></ul><h4 id="设置门限"><a name="设置门限" href="#设置门限"></a>设置门限</h4><ul>
<li>功能<br>设置各个操作所需要的门限</li><li><p>成功条件</p>
<ul>
<li>各项参数合法</li></ul>
</li><li><p>protocol结构定义</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>message OperationSetThreshold
{
      int64 tx_threshold = 1;
      repeated OperationTypeThreshold type_thresholds = 4; //type:threshold ，threshold:0 表示删除这个类型的type
}
</code></pre>">message OperationSetThreshold
{
      int64 tx_threshold = 1;
      repeated OperationTypeThreshold type_thresholds = 4; //type:threshold ，threshold:0 表示删除这个类型的type
}
</code></pre>
<p>OperationTypeThreshold的结构定义如下</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>message OperationTypeThreshold{
   Operation.Type type = 1;  //操作码，哪种操作
   int64 threshold = 2;    //代表这种操作所需的权重门限
}
</code></pre>">message OperationTypeThreshold{
   Operation.Type type = 1;  //操作码，哪种操作
   int64 threshold = 2;    //代表这种操作所需的权重门限
}
</code></pre>
</li></ul><h2 id="4-高级功能"><a name="4-高级功能" href="#4-高级功能"></a>4 高级功能</h2><h3 id="4.1-控制权的分配"><a name="4.1-控制权的分配" href="#4.1-控制权的分配"></a>4.1 <span id="power">控制权的分配</span></h3><p>您在创建一个账号时，可以指定这个账号的控制权分配。您可以通过设置priv的值设置。下面是一个简单的例子</p><pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>{
    &quot;master_weight&quot;: 70,//本地址私钥拥有的权力值 70
    &quot;signers&quot;: [//分配出去的权力
        {
            &quot;address&quot;: &quot;a0023db6c3e25fb110ae596a57ebbb69900b6fda651534&quot;,
            &quot;weight&quot;: 55    //上面这个地址拥有权力值55
        },
        {
            &quot;address&quot;: &quot;a002567bcf969137a7b4f910dbbde35a0de8450c641e08&quot;,
            &quot;weight&quot;: 100    //上面这个地址拥有权力值100
        }
    ],
    &quot;thresholds&quot;://不同的操作所需的权力阈值
    {
        &quot;tx_threshold&quot;: 8,//发起交易需要权力值 8
        &quot;type_thresholds&quot;: [
            {
                &quot;type&quot;: 1,//创建账号需要权利值 11
                &quot;threshold&quot;: 11
            },
            {//发行资产需要权利值 21
                &quot;type&quot;: 2,
                &quot;threshold&quot;: 21
            },
            {//转移资产需要权力值 33
                &quot;type&quot;: 3,
                &quot;threshold&quot;: 31
            },
            {//设置metadata需要权利值 41
                &quot;type&quot;: 4,
                &quot;threshold&quot;: 41
            },
            {//变更控制人的权力值需要权利值 51
                &quot;type&quot;: 5,
                &quot;threshold&quot;: 51
            },
            {//变更各种操作的阈值需要权利值 61
                &quot;type&quot;: 6,
                &quot;threshold&quot;: 61
            }
        ]
    }
}
</code></pre>">{
    "master_weight": 70,//本地址私钥拥有的权力值 70
    "signers": [//分配出去的权力
        {
            "address": "a0023db6c3e25fb110ae596a57ebbb69900b6fda651534",
            "weight": 55    //上面这个地址拥有权力值55
        },
        {
            "address": "a002567bcf969137a7b4f910dbbde35a0de8450c641e08",
            "weight": 100    //上面这个地址拥有权力值100
        }
    ],
    "thresholds"://不同的操作所需的权力阈值
    {
        "tx_threshold": 8,//发起交易需要权力值 8
        "type_thresholds": [
            {
                "type": 1,//创建账号需要权利值 11
                "threshold": 11
            },
            {//发行资产需要权利值 21
                "type": 2,
                "threshold": 21
            },
            {//转移资产需要权力值 33
                "type": 3,
                "threshold": 31
            },
            {//设置metadata需要权利值 41
                "type": 4,
                "threshold": 41
            },
            {//变更控制人的权力值需要权利值 51
                "type": 5,
                "threshold": 51
            },
            {//变更各种操作的阈值需要权利值 61
                "type": 6,
                "threshold": 61
            }
        ]
    }
}
</code></pre><h3 id="4.2-版本化控制"><a name="4.2-版本化控制" href="#4.2-版本化控制"></a>4.2 <span id="version">版本化控制</span></h3><p>每一个账号的metadata都是一个版本化的小型数据库。版本化的特点是可以避免修改冲突问题。</p><h3 id="4.3-表达式"><a name="4.3-表达式" href="#4.3-表达式"></a>4.3 <span id="condition">表达式</span></h3><p>该表达式字段，用于自定义交易有效规则，比如设置交易在某个账户的master_weight 大于 100 有效，则填：</p><pre class="javascript hljs"><code class="JavaScript" data-origin="<pre><code class=&quot;JavaScript&quot;>jsonpath(account(&quot;bubiV8i6mtcDN5a1X7PbRPuaZuo63QRrHxHGr98s&quot;), &quot;.priv.master_weight&quot;) &amp;gt; 100
</code></pre>">jsonpath(account(<span class="hljs-string">"bubiV8i6mtcDN5a1X7PbRPuaZuo63QRrHxHGr98s"</span>), <span class="hljs-string">".priv.master_weight"</span>) &gt; <span class="hljs-number">100</span>
</code></pre><p>表达式可用的函数</p><table>
<thead>
<tr>
<th style="text-align:left">参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">account(address)</td>
<td>获取账户信息, 返回 json 序列化字符串</td>
</tr>
<tr>
<td style="text-align:left">jsonpath(json_string, path)</td>
<td>获取json对象的属性值 </td>
</tr>
<tr>
<td style="text-align:left">LEDGER_SEQ</td>
<td>内置变量，代表最新的区块高度</td>
</tr>
<tr>
<td style="text-align:left">LEDGER_TIME</td>
<td>内置变量，代表最新的区块生成时间</td>
</tr>
<tr>
<td style="text-align:left"><code>( )</code> <code>=</code></td>
<td>嵌套括号，函数调用如sqrt(x)</td>
</tr>
<tr>
<td style="text-align:left"><code>*</code> <code>/</code></td>
<td>乘法、除法</td>
</tr>
<tr>
<td style="text-align:left"><code>+</code> <code>-</code></td>
<td>加法、减法</td>
</tr>
<tr>
<td style="text-align:left"><code>&lt;</code> <code>&lt;=</code>  <code>&gt;</code>  <code>&gt;=</code>  <code>==</code>  <code>!=</code></td>
<td>比较运算</td>
</tr>
<tr>
<td style="text-align:left"><code>&amp;&amp;</code></td>
<td>与 运算</td>
</tr>
<tr>
<td style="text-align:left">|</td>
<td>或运算</td>
</tr>
<tr>
<td style="text-align:left">,</td>
<td>逗号运算</td>
</tr>
</tbody>
</table><blockquote>
<p>例：Alice发起了一笔交易，她想要使这笔交易在5秒内有效。她发现当前时间戳(微秒)是 <code>1506393720000000</code>，5秒之后也就是 <code>1506393725000000</code>。那么她就可以在交易中的<code>expr_condition</code>字段写上下面这句</p>
<pre class="json hljs"><code class="json" data-origin="<pre><code class=&quot;json&quot;>LEDGER_TIME &amp;gt;= 1506393720000000 &amp;amp;&amp;amp; LEDGER_TIME &amp;lt;= 1506393725000000
</code></pre>">LEDGER_TIME &gt;= 1506393720000000 &amp;&amp; LEDGER_TIME &lt;= 1506393725000000
</code></pre>
<p>这句话的意思是，该交易只在时间范围<code>[1506393720000000, 1506393725000000]</code>内有效。<br>过段时间之后，Alice发现当前时间已经超过1506393725000000，那么Alice就可以断定这笔交易要么已经被处理，要么已经彻底失效。</p>
</blockquote><h3 id="4.3-合约"><a name="4.3-合约" href="#4.3-合约"></a>4.3 <span id="contract">合约</span></h3><p>合约是一段JavaScript代码,标准(ECMAScript as specified in ECMA-262)。合约的入口函数是main函数，您写的合约代码中必须有main函数的定义。该函数的入参是字符串input，是调用该合约的时候指定的。<br>下面是一个简单的例子</p><pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>function foo(bar)
{
  /*do whatever you want*/

}
function main(input)
{
  var para = JSON.parse(input);
  if (para.do_foo)
  {
    var x = {
      'hello' : 'world'
    };
    foo(x);
  }
}
</code></pre>"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foo</span><span class="hljs-params">(bar)</span>
</span>{
  <span class="hljs-comment">/*do whatever you want*/</span>

}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span><span class="hljs-params">(input)</span>
</span>{
  <span class="hljs-keyword">var</span> para = <span class="hljs-built_in">JSON</span>.parse(input);
  <span class="hljs-keyword">if</span> (para.do_foo)
  {
    <span class="hljs-keyword">var</span> x = {
      <span class="hljs-string">'hello'</span> : <span class="hljs-string">'world'</span>
    };
    foo(x);
  }
}
</code></pre><p>系统提供了几个全局函数, 这些函数可以获取区块链的一些信息，也可驱动账号发起交易<br><mark> 注意，自定义的函数和变量不要与内置变量和全局函数重名，否则会造成不可控的数据错误。 </mark></p><h4 id="4.3.1-内置函数"><a name="4.3.1-内置函数" href="#4.3.1-内置函数"></a>4.3.1 内置函数</h4><ul>
<li><h5 id="获取账号信息(不包含metada和资产)"><a name="获取账号信息(不包含metada和资产)" href="#获取账号信息(不包含metada和资产)"></a>获取账号信息(不包含metada和资产)</h5>
<p>  <code>callBackGetAccountInfo(address);</code><br>   address: 账号地址</p>
<p>  例如</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>  var account = callBackGetAccountInfo('a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18');
  /*
  account具有如下格式
   {
      &quot;address&quot;: &quot;a002943cede1be5fb0ca0da9f9b49b0ce20b613357524a&quot;,
      &quot;assets_hash&quot;: &quot;5aef61a8988ce2be1da67cf4b37717748c352b8e4a0bdad2ad0964f80aca0101&quot;,
      &quot;contract&quot;: null,
      &quot;priv&quot;: null,
      &quot;storage_hash&quot;: &quot;e4775fb7fc2a5a06a4bbe0e63f362f8e24ff7752f0259ccd2fe1fc2e6e68781a&quot;
    }
  */
</code></pre>">  <span class="hljs-keyword">var</span> account = callBackGetAccountInfo(<span class="hljs-string">'a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18'</span>);
  <span class="hljs-comment">/*
  account具有如下格式
   {
      "address": "a002943cede1be5fb0ca0da9f9b49b0ce20b613357524a",
      "assets_hash": "5aef61a8988ce2be1da67cf4b37717748c352b8e4a0bdad2ad0964f80aca0101",
      "contract": null,
      "priv": null,
      "storage_hash": "e4775fb7fc2a5a06a4bbe0e63f362f8e24ff7752f0259ccd2fe1fc2e6e68781a"
    }
  */</span>
</code></pre>
</li><li><h5 id="获取某个账号的metadata信息"><a name="获取某个账号的metadata信息" href="#获取某个账号的metadata信息"></a>获取某个账号的metadata信息</h5>
<p>  <code>callBackGetAccountMetaData(account_address, metadata_key);</code></p>
<ul>
<li>account_address: 账号地址</li><li><p>metadata_key： metadata的key</p>
<p>例如</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>var bar = callBackGetAccountMetaData('a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18','abc');
/*
bar的值是如下的格式
{
   'key':'abc',
   'value':'hello world',
   'version':12
}
*/
</code></pre>"><span class="hljs-keyword">var</span> bar = callBackGetAccountMetaData(<span class="hljs-string">'a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18'</span>,<span class="hljs-string">'abc'</span>);
<span class="hljs-comment">/*
bar的值是如下的格式
{
   'key':'abc',
   'value':'hello world',
   'version':12
}
*/</span>
</code></pre>
<p>即可得到账号a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18的metadata中abc的值</p>
</li></ul>
</li><li><h5 id="获取某个账号的资产信息"><a name="获取某个账号的资产信息" href="#获取某个账号的资产信息"></a>获取某个账号的资产信息</h5>
<p>  <code>callBackGetAccountAsset(account_address, asset_property);</code></p>
<ul>
<li>account_address: 账号地址</li><li><p>asset_property： 资产属性</p>
<p>例如</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>var asset_property =
{
'issuer' : 'a002bbe0b6f547d6bec2c83fb9bb93e75d37c1755f2de6',
'code' : 'CNY'
};
var bar = callBackGetAccountAsset('a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18', asset_property);

/*
{
&quot;amount&quot;: 1,
&quot;property&quot;: {
  &quot;code&quot;: &quot;CNY&quot;,
  &quot;issuer&quot;: &quot;a002bbe0b6f547d6bec2c83fb9bb93e75d37c1755f2de6&quot;
}
}
*/
</code></pre>"><span class="hljs-keyword">var</span> asset_property =
{
<span class="hljs-string">'issuer'</span> : <span class="hljs-string">'a002bbe0b6f547d6bec2c83fb9bb93e75d37c1755f2de6'</span>,
<span class="hljs-string">'code'</span> : <span class="hljs-string">'CNY'</span>
};
<span class="hljs-keyword">var</span> bar = callBackGetAccountAsset(<span class="hljs-string">'a0025e6de5a793da4b5b00715b7774916c06e9a72b7c18'</span>, asset_property);

<span class="hljs-comment">/*
{
"amount": 1,
"property": {
  "code": "CNY",
  "issuer": "a002bbe0b6f547d6bec2c83fb9bb93e75d37c1755f2de6"
}
}
*/</span>
</code></pre>
</li></ul>
</li><li><h5 id="获取区块信息"><a name="获取区块信息" href="#获取区块信息"></a>获取区块信息</h5>
<p>  <code>callBackGetLedgerInfo(ledger_seq);</code></p>
<ul>
<li><p>ledger_seq: 区块号</p>
<p>例如</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>var ledger = callBackGetLedgerInfo(40);
/*
ledger具有如下格式
{
  &quot;account_tree_hash&quot;: &quot;af05a60772cfd39f3b7838f4032f50450c100dedddf88e0132066688f6ae5c14&quot;,
  &quot;consensus_value&quot;: {
    &quot;close_time&quot;: 1495855656157405,
    &quot;payload&quot;: &quot;240398d89a5efba398fefb0dc194b45abe7b9dbc35326ee8238fff6633371004&quot;
  },
  &quot;hash&quot;: &quot;9f82d8ad1c381e1ce2ce00c559fb2cf3a386d79e9414e92ce3ed809258913384&quot;,
  &quot;ledger_sequence&quot;: 40,
  &quot;ledger_version&quot;: 1000,
  &quot;previous_hash&quot;: &quot;3ff9b79479d62e7c52f2c0ab08598d219ffd4403bd5c1337764d3591e9b0ba24&quot;,
  &quot;transaction_tree_hash&quot;: &quot;e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855&quot;,
  &quot;tx_count&quot;: 34359738368
}
*/
</code></pre>"><span class="hljs-keyword">var</span> ledger = callBackGetLedgerInfo(<span class="hljs-number">40</span>);
<span class="hljs-comment">/*
ledger具有如下格式
{
  "account_tree_hash": "af05a60772cfd39f3b7838f4032f50450c100dedddf88e0132066688f6ae5c14",
  "consensus_value": {
    "close_time": 1495855656157405,
    "payload": "240398d89a5efba398fefb0dc194b45abe7b9dbc35326ee8238fff6633371004"
  },
  "hash": "9f82d8ad1c381e1ce2ce00c559fb2cf3a386d79e9414e92ce3ed809258913384",
  "ledger_sequence": 40,
  "ledger_version": 1000,
  "previous_hash": "3ff9b79479d62e7c52f2c0ab08598d219ffd4403bd5c1337764d3591e9b0ba24",
  "transaction_tree_hash": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855",
  "tx_count": 34359738368
}
*/</span>
</code></pre>
</li></ul>
</li></ul><ul>
<li><h5 id="做交易"><a name="做交易" href="#做交易"></a>做交易</h5>
<p>  令合约账号做一笔交易，即里面的任意一个操作的source_address都会自动变成合约账号。<br>  所以source_address是不需要填写的，即使填写也无用。</p>
<p>  <code>callBackDoOperation(transaction);</code></p>
<ul>
<li><p>transaction: 交易内容<br>返回: true/false</p>
<p>例如</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>var transaction =
{
'operations' :
[
  {
    &quot;type&quot; : 2,
    &quot;issue_asset&quot; :
    {
      &quot;amount&quot; : 1000,
      &quot;code&quot; : &quot;CNY&quot;
    }
  }
]
};

var result = callBackDoOperation(transaction);
</code></pre>"><span class="hljs-keyword">var</span> transaction =
{
<span class="hljs-string">'operations'</span> :
[
  {
    <span class="hljs-string">"type"</span> : <span class="hljs-number">2</span>,
    <span class="hljs-string">"issue_asset"</span> :
    {
      <span class="hljs-string">"amount"</span> : <span class="hljs-number">1000</span>,
      <span class="hljs-string">"code"</span> : <span class="hljs-string">"CNY"</span>
    }
  }
]
};

<span class="hljs-keyword">var</span> result = callBackDoOperation(transaction);
</code></pre>
</li></ul>
</li></ul><h4 id="4.3.2-内置变量"><a name="4.3.2-内置变量" href="#4.3.2-内置变量"></a>4.3.2 内置变量</h4><ul>
<li><h5 id="该合约账号的地址"><a name="该合约账号的地址" href="#该合约账号的地址"></a>该合约账号的地址</h5>
<p>  thisAddress</p>
<p>  全局变量<code>thisAddress</code>的值等于该合约账号的地址。</p>
<p>  例如账号x发起了一笔交易调用合约Y，本次执行过程中，thisAddress的值就是Y合约账号的地址。</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>  var bar = thisAddress;
  /*
  bar的值是Y合约的账号地址。
  */
</code></pre>">  <span class="hljs-keyword">var</span> bar = thisAddress;
  <span class="hljs-comment">/*
  bar的值是Y合约的账号地址。
  */</span>
</code></pre>
</li><li><h5 id="调用者的地址"><a name="调用者的地址" href="#调用者的地址"></a>调用者的地址</h5>
<p>  sender<br>  <code>sender</code> 的值等于本次调用该合约的账号。</p>
<p>  例如某账号发起了一笔交易，该交易中有个操作是调用合约Y（该操作的source_address是x），那么合约Y执行过程中，sender的值就是x账号的地址。</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>  var bar = sender;
  /*
  那么bar的值是x的账号地址。
  */
</code></pre>">  <span class="hljs-keyword">var</span> bar = sender;
  <span class="hljs-comment">/*
  那么bar的值是x的账号地址。
  */</span>
</code></pre>
</li><li><h5 id="触发本次合约的交易"><a name="触发本次合约的交易" href="#触发本次合约的交易"></a>触发本次合约的交易</h5>
<p>  trigger</p>
<p>  <code>trigger</code> 的值等于触发本次合约的交易。</p>
<p>  例如某账号A发起了一笔交易tx0，tx0中有一个操作是给某个合约账户转移资产(调用合约), 那么<code>trigger</code>的值就是交易tx0。</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>  var bar = trigger;
  /*
  那么bar的值是触发本次合约的交易。
  */
</code></pre>">  <span class="hljs-keyword">var</span> bar = trigger;
  <span class="hljs-comment">/*
  那么bar的值是触发本次合约的交易。
  */</span>
</code></pre>
</li><li><h5 id="触发本次合约调用的操作的序号"><a name="触发本次合约调用的操作的序号" href="#触发本次合约调用的操作的序号"></a>触发本次合约调用的操作的序号</h5>
<p>  triggerIndex</p>
<p>  <code>triggerIndex</code> 的值等于触发本次合约的操作的序号。</p>
<p>  例如某账号A发起了一笔交易tx0，tx0中第0（从0开始计数）个操作是给某个合约账户转移资产(调用合约), 那么<code>triggerIndex</code>的值就是0。</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>  var bar = triggerIndex;
  /* bar 是一个非负整数*/
</code></pre>">  <span class="hljs-keyword">var</span> bar = triggerIndex;
  <span class="hljs-comment">/* bar 是一个非负整数*/</span>
</code></pre>
</li><li><h5 id="本次共识数据"><a name="本次共识数据" href="#本次共识数据"></a>本次共识数据</h5>
<p>  consensusValue</p>
<p>  <code>consensusValue</code> 当前块(正在生成的块)的共识数据。<br>  consensusValue的数据结构可以在src/proto/chain.proto中找到ConsensusValue。<br>  ConsensusValue是一个protobuffer对象，根据protobuffer对象转为json格式的标准方法转换，即是<code>consensusValue</code>的值。</p>
<pre class="javascript hljs"><code class="javascript" data-origin="<pre><code class=&quot;javascript&quot;>  var bar = consensusValue;
  /*consensusValue结构比较复杂，常用的数据有以下几个:*/
  consensusValue.close_time;    /*当前时间,也就是区块生成时间*/
  consensusValue.ledger_seq;     /*当前区块序号*/
  consensusValue.previous_ledger_hash; /*上一个区块hash*/
</code></pre>">  <span class="hljs-keyword">var</span> bar = consensusValue;
  <span class="hljs-comment">/*consensusValue结构比较复杂，常用的数据有以下几个:*/</span>
  consensusValue.close_time;    <span class="hljs-comment">/*当前时间,也就是区块生成时间*/</span>
  consensusValue.ledger_seq;     <span class="hljs-comment">/*当前区块序号*/</span>
  consensusValue.previous_ledger_hash; <span class="hljs-comment">/*上一个区块hash*/</span>
</code></pre>
</li></ul><h2 id="5.-错误码"><a name="5.-错误码" href="#5.-错误码"></a>5.  错误码</h2><p>错误由两部分构成:</p><ul>
<li>error_code : 错误码，大概的错误分类</li><li>error_desc : 错误描述，一般能从错误描述准确发现错误具体信息</li></ul><p>错误列表如下：</p><table>
<thead>
<tr>
<th style="text-align:left">error_code</th>
<th>enum</th>
<th>error_desc</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td>ERRCODE_SUCCESS</td>
<td>操作成功</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td>ERRCODE_INTERNAL_ERROR</td>
<td>服务内部错误</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td>ERRCODE_INVALID_PARAMETER</td>
<td>参数错误</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td>ERRCODE_ALREADY_EXIST</td>
<td>对象已存在， 如重复提交交易</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td>ERRCODE_NOT_EXIST</td>
<td>对象不存在，如查询不到账号、TX、区块等</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td>ERRCODE_TX_TIMEOUT</td>
<td>TX 超时，指该 TX 已经被当前节点从 TX 缓存队列去掉，<mark>但并不代表这个一定不能被执行</mark></td>
</tr>
<tr>
<td style="text-align:left">20</td>
<td>ERRCODE_EXPR_CONDITION_RESULT_FALSE</td>
<td>指表达式执行结果为 false，意味着该 TX 当前没有执行成功，<mark>但这并不代表在以后的区块不能成功</mark></td>
</tr>
<tr>
<td style="text-align:left">21</td>
<td>ERRCODE_EXPR_CONDITION_SYNTAX_ERROR</td>
<td>指表达式语法分析错误，代表该 TX 一定会失败</td>
</tr>
<tr>
<td style="text-align:left">90</td>
<td>ERRCODE_INVALID_PUBKEY</td>
<td>公钥非法 </td>
</tr>
<tr>
<td style="text-align:left">91</td>
<td>ERRCODE_INVALID_PRIKEY</td>
<td>私钥非法</td>
</tr>
<tr>
<td style="text-align:left">92</td>
<td>ERRCODE_ASSET_INVALID</td>
<td>资产issue 地址非法</td>
<td>code长度不在有效范围内</td>
<td>数额不在有效范围</td>
</tr>
<tr>
<td style="text-align:left">93</td>
<td>ERRCODE_INVALID_SIGNATURE</td>
<td>签名权重不够，达不到操作的门限值</td>
</tr>
<tr>
<td style="text-align:left">94</td>
<td>ERRCODE_INVALID_ADDRESS</td>
<td>地址非法</td>
</tr>
<tr>
<td style="text-align:left">97</td>
<td>ERRCODE_MISSING_OPERATIONS</td>
<td>交易缺失操作</td>
</tr>
<tr>
<td style="text-align:left">99</td>
<td>ERRCODE_BAD_SEQUENCE</td>
<td>交易序号错误</td>
</tr>
<tr>
<td style="text-align:left">100</td>
<td>ERRCODE_ACCOUNT_LOW_RESERVE</td>
<td>余额不足</td>
</tr>
<tr>
<td style="text-align:left">101</td>
<td>ERRCODE_ACCOUNT_SOURCEDEST_EQUAL</td>
<td>源和目的账号相等</td>
</tr>
<tr>
<td style="text-align:left">102</td>
<td>ERRCODE_ACCOUNT_DEST_EXIST</td>
<td>创建账号操作，目标账号已存在</td>
</tr>
<tr>
<td style="text-align:left">103</td>
<td>ERRCODE_ACCOUNT_NOT_EXIST</td>
<td>账户不存在</td>
</tr>
<tr>
<td style="text-align:left">104</td>
<td>ERRCODE_ACCOUNT_ASSET_LOW_RESERVE</td>
<td>支付操作，资产余额不足</td>
</tr>
<tr>
<td style="text-align:left">105</td>
<td>ERRCODE_ACCOUNT_ASSET_AMOUNT_TOO_LARGE</td>
<td>资产数量过大，超出了int64的范围</td>
</tr>
<tr>
<td style="text-align:left">114</td>
<td>ERRCODE_OUT_OF_TXCACHE</td>
<td>TX 缓存队列已满</td>
</tr>
<tr>
<td style="text-align:left">120</td>
<td>ERRCODE_WEIGHT_NOT_VALID</td>
<td>权重值不在有效范围内</td>
</tr>
<tr>
<td style="text-align:left">121</td>
<td>ERRCODE_THRESHOLD_NOT_VALID</td>
<td>门限值不在有效范围内</td>
</tr>
<tr>
<td style="text-align:left">144</td>
<td>ERRCODE_INVALID_DATAVERSION</td>
<td>metadata的version版本号不与已有的匹配（一个版本化的数据库）</td>
</tr>
<tr>
<td style="text-align:left">151</td>
<td>ERRCODE_CONTRACT_EXECUTE_FAIL</td>
<td>合约执行失败</td>
</tr>
<tr>
<td style="text-align:left">152</td>
<td>ERRCODE_CONTRACT_SYNTAX_ERROR</td>
<td>合约语法分析失败</td>
</tr>
</tbody>
</table>

<footer style="position:fixed; font-size:.8em; text-align:right; bottom:0px; margin-left:-25px; height:20px; width:100%;">generated by <a href="http://pad.haroopress.com" target="_blank">haroopad</a></footer>
</body>
</html>
